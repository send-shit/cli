language: go

sudo: false

matrix:
  include:
    - go: 1.x
      env: LATEST=true

before_install:
  - go get github.com/mitchellh/gox

script:
  - go get -t -v ./...
  - diff -u <(echo -n) <(gofmt -d .)
  - go vet $(go list ./... | grep -v /vendor/)
  - if [ "${LATEST}" = "true" ]; then gox -os="linux darwin windows" -arch="amd64" -output="sendshit.." -ldflags "-X main.Rev=`git rev-parse --short HEAD`" -verbose ./...; fi

deploy:
  provider: releases
  skip_cleanup: true
  api_key:
    secure: JTyWoDZpaORGL6Zdjf3HJt1P95foQaaZ0+Ockbo9YzqBSdxRdyBj+s5dGTWzFmVFQQ4lsrKAa2s4Ao8L9JQOhMn1GM5Hf0SuuWe9nNDchUDcT9qPbO5dmDnib88Po/5MPvnmUV/m4WTvSbMsK1n8YIOa3Ggnp2FANSUiOce+IGPE6/ZqmaUJ5JqZh9ZYckFTewq2ccoOPad9rpbTQkZP1jFy2kL2iNqyCC6pelK0Fo0sH+KvlakAgN88tXAJVQt3HVFvs5GhK1LknMEjZxYZhQcDSeon6YhCXME7kmpcmXMROOxAebV1t42aflv5rpCDQ9bhqM2XF6nq5RpzCm2YJUhd6VaOvBI9tgmd4n8d/OcEhvO1rYK59qJS7wDvfp1nqvkUwBELp2mSEJWvRc695kBbNlweFIbdkKR/AEJ3Yx5EIyppOjr1bisg6rwFnZcrrZsy+LqmWk/2/u58B3Zl+JZ7uHp05b2/1mm5F4wSbODUK7S0qj1B71PbntzsnaOtqbVKhddP7JZBnndsorzysFrdgtk5Y1IWZBpbZ9djFcFn+mDdnnYzVYFEZ5VX87lAdAZ9c5814CMRLbUN1B+D+v1ANR93D2wb/O7kbW9NTi9CeQ7/f3S2CWudVHpCU1QREFSV+L7rWQ/dIBRYXmRky4Cv8zkR6Odkf1sBLm65nik=
  file:
    - sendshit.windows.amd64.exe
    - sendshit.darwin.amd64
    - sendshit.linux.amd64
  on:
    repo: shitty-inc/sendshit-cli
    condition: $LATEST = true
    tags: true
